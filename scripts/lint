#!/usr/bin/env bash
set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
# shellcheck source=scripts/_helpers.sh
source "$SCRIPT_DIR/_helpers.sh"

export PYTHONPATH="$ROOT_DIR/src:${PYTHONPATH:-}"
ensure_venv

FIX="false"
ARGS=()
for arg in "$@"; do
  if [[ "$arg" == "--fix" ]]; then
    FIX="true"
  else
    ARGS+=("$arg")
  fi
fi

RUFF_ARGS=("check" "src" "tests")
if [[ "$FIX" == "true" ]]; then
  RUFF_ARGS+=("--fix")
fi
RUFF_ARGS+=("${ARGS[@]}")

with_env in_venv ruff "${RUFF_ARGS[@]}"
